<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Breakfast Waste Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 180px;
      background: #2c2c2c;
      color: white;
      padding: 20px;
    }

    .sidebar h3 {
      text-align: center;
      margin-top: 0;
    }

    .sidebar a {
      display: block;
      color: white;
      text-decoration: none;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 4px;
    }

    .sidebar a:hover {
      background: #444;
    }

    .sidebar a.active {
      background: #007bff;
    }

    /* Main content */
    .content {
      flex: 1;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }

    h2 {
      text-align: center;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 100px 80px;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      text-align: center;
    }

    .price {
      text-align: right;
    }

    .total {
      font-weight: bold;
      font-size: 20px;
      text-align: right;
      margin-top: 20px;
    }

    button {
      width: 100%;
      padding: 15px;
      font-size: 18px;
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      .sidebar {
        width: 100px;
        padding: 10px;
      }
    }
  </style>
</head>

<body>

<div class="container">

  <!-- Sidebar -->
  <nav class="sidebar">
    <h3>Eurospar Armagh</h3>
    <a href="index.html" class="active">Waste Log</a>
    <a href="reports.html">Reports</a>
  </nav>

  <!-- Content -->
  <main class="content">

    <h2>Breakfast Waste Log</h2>
    <p id="date" style="text-align:center; font-weight:bold;"></p>

    <div class="row">
      <strong>Item</strong>
      <strong>Qty</strong>
      <strong class="price">£</strong>
    </div>

    <div class="row" data-price="0.99">
      <span>Sausages</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="0.99">
      <span>Bacon</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="0.99">
      <span>Potato Bread</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="0.99">
      <span>Hash Browns</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="1.50">
      <span>Jambons</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="4.95">
      <span>5 piece item (bap/bagel)</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="2.09">
      <span>Scotch Eggs</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="1.00">
      <span>Sausage Rolls (large)</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <div class="row" data-price="0.50">
      <span>Sausage Rolls (small)</span>
      <input type="number" min="0" value="0" class="qty" oninput="updateTotals()">
      <span class="price item-total">£0.00</span>
    </div>

    <hr>

    <div class="total">
      Total Waste: £<span id="grandTotal">0.00</span>
    </div>

    <button onclick="submitWaste()">Submit</button>

  </main>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzV7xLJnZSvLSHp-vgB2UrRz7BLFXgrOs4fpNA0Dq9FeFWLAXpr1SpW0YIZpRqymj47KA/exec";

  // Date
  const dateEl = document.getElementById('date');
  const today = new Date();
  const options = { weekday: 'short', day: 'numeric', month: 'short' };
  dateEl.textContent = today.toLocaleDateString('en-GB', options);

  const rows = document.querySelectorAll('.row[data-price]');
  const grandTotalEl = document.getElementById('grandTotal');

  function updateTotals() {
    let grandTotal = 0;

    rows.forEach(row => {
      const price = Number(row.dataset.price);
      const qty = Number(row.querySelector('.qty').value) || 0;
      const itemTotal = price * qty;

      row.querySelector('.item-total').textContent = "£" + itemTotal.toFixed(2);
      grandTotal += itemTotal;
    });

    grandTotalEl.textContent = grandTotal.toFixed(2);
  }

  function submitWaste() {
    const date = dateEl.textContent;
    const items = [];

    rows.forEach(row => {
      const qty = Number(row.querySelector('.qty').value) || 0;
      if (qty > 0) {
        const price = Number(row.dataset.price);
        items.push({
          name: row.querySelector('span').textContent,
          qty,
          price,
          total: qty * price
        });
      }
    });

    if (items.length === 0) {
      alert("Nothing to submit");
      return;
    }

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ date, items })
    })
    .then(() => {
      alert("Waste submitted successfully");

      document.querySelectorAll('.qty').forEach(i => i.value = 0);
      document.querySelectorAll('.item-total').forEach(t => t.textContent = "£0.00");
      grandTotalEl.textContent = "0.00";
    })
    .catch(() => alert("Error submitting data"));
  }
</script>

</body>
</html>
